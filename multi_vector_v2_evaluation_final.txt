================================================================================
MULTI-VECTOR RETRIEVAL V2 - EVALUATION
================================================================================

Approach: Query Deconstruction → Multi-Vector Search → LLM Reranking
This ensures balanced recommendations (technical + behavioral tests)

✓ Loaded Multi-Vector Retriever V2
  - 353 assessments
  - Gemini embeddings (3072-dim)
  - Query deconstruction + LLM reranking enabled

================================================================================
RUNNING EVALUATION ON TRAINING SET
================================================================================

[Query 1/10]
Ground Truth: 5 assessments

================================================================================
Query: I am hiring for Java developers who can also collaborate effectively with my business teams. Looking...
================================================================================

[Step 1] Deconstructing query into search facets...
  Rate limit in deconstruction, waiting 30.7s (attempt 1/3)...
  Generated 1 search queries:
    1. I am hiring for Java developers who can also collaborate effectively with my business teams. Looking for an assessment(s) that can be completed in 40 minutes.

[Step 2] Running semantic searches for each facet...
  Search 1/1: 'I am hiring for Java developers who can also collaborate effectively with my business teams. Looking for an assessment(s) that can be completed in 40 minutes.'
  Rate limit hit, waiting 1.0s before retry (attempt 1/3)...
  Rate limit hit, waiting 2.0s before retry (attempt 2/3)...
Traceback (most recent call last):
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/google/api_core/grpc_helpers.py", line 72, in error_remapped_callable
    return callable_(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/grpc/_interceptor.py", line 277, in __call__
    response, ignored_call = self._with_call(
                             ^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/grpc/_interceptor.py", line 332, in _with_call
    return call.result(), call
           ^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/grpc/_channel.py", line 440, in result
    raise self
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/grpc/_interceptor.py", line 315, in continuation
    response, call = self._thunk(new_method).with_call(
                     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/grpc/_channel.py", line 1198, in with_call
    return _end_unary_response_blocking(state, call, True, None)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/grpc/_channel.py", line 1006, in _end_unary_response_blocking
    raise _InactiveRpcError(state)  # pytype: disable=not-instantiable
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
grpc._channel._InactiveRpcError: <_InactiveRpcError of RPC that terminated with:
	status = StatusCode.RESOURCE_EXHAUSTED
	details = "You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. 
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0"
	debug_error_string = "UNKNOWN:Error received from peer ipv6:%5B2404:6800:4002:808::200a%5D:443 {grpc_message:"You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. \n* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0\n* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0\n* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0\n* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0", grpc_status:8, created_time:"2025-11-08T16:39:04.413039+05:30"}"
>

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/sakshampoply/Projects/SHL/evaluate_multi_vector_v2.py", line 109, in <module>
    main()
  File "/Users/sakshampoply/Projects/SHL/evaluate_multi_vector_v2.py", line 47, in main
    results = retriever.retrieve(
              ^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/Projects/SHL/src/multi_vector_retriever_v2.py", line 158, in retrieve
    candidates = self._semantic_search(search_query, candidates_per_facet)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/Projects/SHL/src/multi_vector_retriever_v2.py", line 217, in _semantic_search
    result = retry_with_backoff(_get_embedding, max_retries=3, initial_delay=1.0)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/Projects/SHL/src/multi_vector_retriever_v2.py", line 33, in retry_with_backoff
    return func()
           ^^^^^^
  File "/Users/sakshampoply/Projects/SHL/src/multi_vector_retriever_v2.py", line 210, in _get_embedding
    return genai.embed_content(
           ^^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/google/generativeai/embedding.py", line 213, in embed_content
    embedding_response = client.embed_content(
                         ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 1263, in embed_content
    response = rpc(
               ^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/google/api_core/gapic_v1/method.py", line 113, in __call__
    return wrapped_func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/google/api_core/retry.py", line 349, in retry_wrapped_func
    return retry_target(
           ^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/google/api_core/retry.py", line 191, in retry_target
    return target()
           ^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/google/api_core/timeout.py", line 120, in func_with_timeout
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Users/sakshampoply/anaconda3/lib/python3.11/site-packages/google/api_core/grpc_helpers.py", line 74, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.ResourceExhausted: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. 
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0 [links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, violations {
}
violations {
}
violations {
}
violations {
}
]
